<div class="expanded margin-none dashboard-wrapper">
  <% if current_user %>
      <%= render 'layouts/sidebar_navigation' %>
  <% end %>

  <section class="s-wallet">
    <div class="container-own">
      <h1 class="s-wallet__title">My Wallet</h1>
      <div class="s-wallet__top-bar">
        <div class="s-wallet__top-bar-left">
          <h3 class="s-wallet__subtitle">Receive address</h3>
          <div class="s-wallet__btc-address"><%= @wallet_address.sender_address rescue 'Available Soon' %></div>
          <button class="s-wallet__qr">
            <div id="qrcode" class="s-wallet__qr-wrap"></div>
            <svg focusable="false" version="1.1" class="svg-qr">
                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-qr"></use>
            </svg>
            <script>
              $('#qrcode').qrcode("<%= @wallet_address.sender_address %>");
            </script>
            Show QR-Code
          </button> <!-- todo show qr code -->
        </div>
        <div class="s-wallet__top-bar-right">
          <div class="s-wallet__btc">
            <span class="s-wallet__value"><%= satoshi_balance_in_btc(@wallet_address.current_balance) %></span> BTC
          </div>
          <div class="s-wallet__usd">
            $<span class="s-wallet__value"><%= satoshi_balance_in_usd(@wallet_address.current_balance) %></span> USD
          </div>
        </div>
      </div>
      <div class="s-wallet__content _active">
        <div class="s-wallet__content-header">
          <h3 class="s-wallet__subtitle">Transactions</h3>
          <button class="btn-root js-toggle-content" type="button">Make a transaction</button>
        </div>
        <div class="s-wallet__content-main">
          <div class="t-transactions">
            <div class="t-transactions__row _head">
              <div class="t-transactions__th">Date</div>
              <div class="t-transactions__th">Description</div>
              <div class="t-transactions__th">Amount</div>
              <div class="t-transactions__th">Balance</div>
            </div>

            <% if @transactions['transactions'].present? %>
                <% @transactions['transactions'].each do |transaction| %>
                    <% transaction['entries'].each do |entry| %>
                        <div class="t-transactions__row">
                          <div class="t-transactions__td">
                            <% if entry['value'].to_f > 0.0 %>
                                <svg focusable="false" version="1.1" class="svg-arrow _in">
                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-arrow"></use>
                                </svg>
                                <%= DateTime.parse(transaction['date']).strftime('%b %d %Y, %I:%M %p') %>
                                </div>
                                <div class="t-transactions__td">Recieved From: <%= entry['account'] %></div>
                            <% else %>
                                <svg focusable="false" version="1.1" class="svg-arrow _out">
                                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-arrow"></use>
                                </svg>
                                <%= DateTime.parse(transaction['date']).strftime('%b %d %Y, %I:%M %p') %>
                                </div>
                                <div class="t-transactions__td">Sent to: <%= entry['account'] %></div>
                            <% end %>

                            <div class="t-transactions__td _tar">
                              <div class="t-transactions__expense"><%= satoshi_balance_in_btc(entry['value']) %></div>
                              <div class="t-transactions__value">$ <%= satoshi_balance_in_usd(entry['value']) %></div>
                            </div>
                            <div class="t-transactions__td _tar">
                              <div class="t-transactions__balance"><%= satoshi_balance_in_btc(entry['value']) %></div>
                            </div>
                            </div>
                    <% end %>
                <% end %>
            <% else %>
                No Transaction
            <% end %>

            </div>
      </div>
    </div>
    <div class="s-wallet__content">
      <button class="s-wallet__back js-toggle-content" type="button">< Transactions</button>
      <!--<form action="" class="f-transaction">-->
        <%= form_tag("/user_wallet_transactions/create", method: "post" ,class:"f-transaction" ) do %>

      <div class="f-transaction__title">Make a transaction</div>

        <div class="f-default__row">
          <label class="f-default__label">
            <span class="f-default__label-text">Bitcoin address or label</span>
            <!--<input type="text" class="f-default__field" required>-->
            <input type="text" id="wallet_transaction_user_wallet" name="wallet_transaction_user_wallet"  required="true" class="form-control" placeholder='Please Enter Receiver Wallet Address' />

          </label>
        </div>
        <div class="f-default__row">
          <label class="f-default__label _btc">
            <span class="f-default__label-text">Enter amount</span>
            <!--<input type="number" class="f-default__field numeric integer" required>-->
            <input type="number" id="wallet_transaction_amount" name="amount" class="f-default__field numeric integer _min-donation"  required="true" placeholder=''/>

            <div class="f-transaction__btc">BTC</div>
          </label>
          <div class="f-transaction__info">
            Available: <span class="js-btc-value"><%= satoshi_balance_in_btc(@wallet_address.current_balance) %></span> BTC
          </div>
        </div>
        <div class="f-default__row">
          <label class="f-default__label">
            <span class="f-default__label-text">Optional internal memo</span>
            <input type="text" class="f-default__field">
          </label>
        </div>
        <button class="btn-root _dark">Send</button>
          <%end %>
      <!--</form>-->
    </div>
</div>
</section>
<script type="text/javascript">
  $(document).ready(function () {

    var MIN_DONATION = parseFloat('<%= t('commons.min_donation_usd') %>').toFixed(2),
        currentBtc = parseFloat('<%=  get_current_btc_rate  %>').toFixed(2);

    $('.f-default__field._min-donation').attr('min', (MIN_DONATION / currentBtc).toFixed(4));

    $('.js-toggle-content').on('click', function () {
      $(this).parents('.s-wallet__content').removeClass('_active').siblings('.s-wallet__content').addClass('_active');
    });
    $('#wallet_transaction_amount').keypress(function(eve) {
        if(eve.which == 8 || eve.which == 0){
          return true;
        }
        if ((eve.which != 46 || $(this).val().indexOf('.') != -1) && (eve.which < 48 || eve.which > 57)) {
          eve.preventDefault();
        }

    // this part is when left part of number is deleted and leaves a . in the leftmost position. For example, 33.25, then 33 is deleted
        $('#wallet_transaction_amount').keyup(function(eve) {
          if($(this).val().indexOf('.') == 0) {    $(this).val($(this).val().substring(1));
          }
        });
      });
  });
</script>

</div>
