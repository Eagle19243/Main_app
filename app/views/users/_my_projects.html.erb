<% content_for :customhead do %>
  <link rel="stylesheet" type="text/css" href="/static/userdashboard/css/glyphicon-only/glyphicon.css">
  <link rel="stylesheet" type="text/css" href="/static/userdashboard/css/Hover/css/hover-min.css">
  <link rel="stylesheet" type="text/css" href="/static/userdashboard/css/dashboard.css">
<% end %>

<div class="table-responsive columns">
  <h3> <i class="fa fa-file-text-o" aria-hidden="true"></i> Projects</h4>
  
    <% if @user.projects.count == 0 %>
      <h4>There are no projects yet.</h4>
    <% else %>
      <table class="project-table table table-striped" border="1">
        <tr>
          <th>NAME</th>
          <th>FUNDED / NEEDED</th>
          <th>TEAM / NEEDED</th>
          <th>TAKS COMPLETED</th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
        <% @user.projects.each do |project| %>
        <tr>
          <td><%= project.title %></td>
          <td>
            <span class="green_font">$ <%= project_funded(project)%></span>
            / $ <%= project_budget(project) %></td>
          <td>
            <%= project.team_relations_string %>
          </td>
          <td><span class="green_font"><%= project.accepted_tasks.count %> </span>/ <%= project.tasks.count%></td>
          <td>
            <a href="#">
              <i class="fa fa-bell" aria-hidden="true">
                <span class="hvr-push">1</span>
              </i>
            </a>
          </td>
          <td>
            <%= link_to edit_project_path(project) do %>
              <i class="fa fa-pencil" aria-hidden="true"></i> 
              Edit 
            <% end %>
          </td>
          <td>
            <%= link_to project_path(project) do %>
              <i class="fa fa-external-link" aria-hidden="true"></i> 
              See Project
            <% end %>
          </td>
          <td>
            <a href="#" data-toggle="modal" data-target="#change-leader-modal" data-id="<%= project.id %>">
              <i class="fa fa-users" aria-hidden="true"></i>
              Change Leader
            </a>
          </td>
          <td>
            <%= link_to project_path(project), method: :delete, :data => { :confirm => "Are you sure you want to delete this project?" } do%>
              <i class="fa fa-trash-o" aria-hidden="true"></i>
              Delete
            <% end %>
          </td>
        </tr>
        <% end %>
      </table>
    <% end %>
  <br />

  <h3> <i class="fa fa-star-o" aria-hidden="true"></i>Followed projects</h4>
  <% if @user.followed_projects.count == 0 %>
    <h4>There are no followed projects yet.</h4>
  <% else %>
    <table class="project-table table" border="1">
      <tr>
        <th>NAME</th>
        <th>FUNDED / NEEDED</th>
        <th>TEAM / NEEDED</th>
        <th>TAKS COMPLETED</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
      <% @user.followed_projects.each do |followed_project| %>
        <tr>
          <td><%= followed_project.title %></td>
          <td>
            <span class="green_font">$ <%= project_funded(followed_project)%></span>
            / $ <%= project_budget(followed_project) %></td>
          <td>
            <%= followed_project.team_relations_string %>
          </td>
          <td>
            <span class="green_font"><%= followed_project.accepted_tasks.count %> </span>
            / <%= followed_project.tasks.count%>
          </td>
          <td>
            <a href="#">
              <i class="fa fa-bell" aria-hidden="true">
                <span class="hvr-push">1</span>
              </i>
            </a>
          </td>
          <td>
            <%= link_to project_path(followed_project) do %>
              <i class="fa fa-external-link" aria-hidden="true"></i> 
              See Project
            <% end %>
          </td>
          <td>
            <%= link_to unfollow_project_path(followed_project) do %>
              <i class="fa fa-external-link" aria-hidden="true"></i> 
              Unfollow
            <% end %>
          </td>
        </tr> 
      <% end %>
    </table>
  <% end %>
</div>

<div class="modal fade" id="change-leader-modal" role="dialog" aria-labelledby="changeConfirm" aria-hidden="true" tabindex="-1">
  <div class="modal-content modal-dialog">
    <div class="modal-header">
      <a class="close" data-dismiss="modal">&#215</a>
      <h3 class="modal-title">
        Who do you want to give your leader's role to?
      </h3>
    </div>

    <div class="modal-body">
      <p>
        Enter email:
      </p>
      <%= form_tag change_leader_projects_path, method: "post" do %>
        <%= hidden_field_tag(:project_id) %>
        <%= email_field(:leader, :address) %>
        <%= submit_tag "Change", :class => "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>
